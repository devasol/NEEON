import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.jsx'
import { AuthProvider } from './context/AuthContext.jsx'
import { BrowserRouter } from 'react-router-dom'
import { jwtDecode } from 'jwt-decode';


function checkUrlParams() {
  const params = new URLSearchParams(window.location.search);
  const token = params.get('token');
  const error = params.get('error');
  
  if (token) {
    try {
      localStorage.setItem('token', token);
      
      
      const decodedToken = jwtDecode(token);
      const isAdmin = decodedToken.role && decodedToken.role.toLowerCase() === 'admin';
      localStorage.setItem('isAdmin', isAdmin ? 'true' : 'false');
      
      
      const newUrl = window.location.pathname + window.location.hash;
      window.history.replaceState({}, document.title, newUrl);
    } catch (error) {
      console.error('Error processing token from URL:', error);
    }
  } else if (error) {
    
    
    console.error('OAuth error:', error);
    
    sessionStorage.setItem('oauthError', error);
    
    
    const newUrl = window.location.pathname + window.location.hash;
    window.history.replaceState({}, document.title, newUrl);
  }
}


checkUrlParams();

createRoot(document.getElementById('root')).render(
	<StrictMode>
		<BrowserRouter>
			<AuthProvider>
				<App />
			</AuthProvider>
		</BrowserRouter>
	</StrictMode>,
)
